<% include ../partials/header %>

<section>
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-9 showBlogContent">
                <div class="container">
                    <img  src="<%= data.image %>" alt="">
                    <h3 class="float-right">$ <%= data.price %>.00</h3>
                    <h2><%= data.title %></h2>
                    <small>Created by: <em><%= data.author.name %></em> <span> <%= moment(data.created).fromNow() %> </span> </small>
                    <hr>
                    <p><%= data.body %></p>

                    <% if(currentUser && data.author.id.equals(currentUser._id)) { %>
                    <a class="btn btn-sm btn-warning" href="/index/<%= data._id %>/edit">Edit</a>
                    <form action="/index/<%= data._id %>?_method=DELETE" method="post" class="d-inline">
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                    <% } %>
                </div>
                <div class="container my-3 showCommentSection">
                    <div class="well">
                        <h3>Reviews</h3>

                        <% data.comment.forEach(function(comment){ %>

                        <h5 class="text-info"><%= comment.author.name %><span> &#8226; <small class="text-warning">posted  <%= moment(comment.created).fromNow()  %></small></span></h5>

                        <p><%= comment.text %></p>

                        <% if(currentUser && comment.author.id.equals(currentUser._id)) {%>

                        <a href="/index/<%= data._id %>/comment/<%= comment._id %>/edit" class="btn btn-sm btn-warning">Edit</a>

                        <form action="/index/<%= data._id %>/comment/<%= comment._id %>?_method=DELETE" class="d-inline" method="post">
                            <button class="btn btn-sm btn-danger">Delete</button>
                        </form>

                        <% } %>
                        <hr>
                        <% }) %>



                        <form action="/index/<%= data._id %>/comment" method="post">
                            <textarea name="comment[text]" cols="10" rows="5" class="form-control my-3" placeholder="Write your comment"></textarea>
                            <button class="btn btn-success">Add Comment</button>
                        </form>


                    </div>
                </div>
            </div> <!--col-md-9-->

            <div class="col-md-3 col-sm-3 showInfoSection">
                <ul>
                    
                    <% allCamp.forEach(function(camp ,i){ %>
                       <% if(i < 3 ) { %>

                    <li> <%= camp.title %></li>

                    <% } %>
                    <%    }) %>
                </ul>

                <div id="map" style="width:100%; height:350px; background: red"></div>
            </div><!--col-3-->


        </div><!--row-->

    </div><!--container-->
</section>


<script>
    function initMap() {
        var lat = <%= data.lat %>;
        var lng = <%= data.lng %>;
        var center = {lat: lat, lng: lng };
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: center,
            scrollwheel: false
        });
        var contentString = `
<strong><%= data.title %><br/>
<%= data.location %></strong>
<p><%= data.body %></p>
`
        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });
        var marker = new google.maps.Marker({
            position: center,
            map: map
        });
        marker.addListener('click', function() {
            infowindow.open(map, marker);
        });
    }

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-rsOXjG5-vXQEjd-YFC4zBBEEAb8tl6w&callback=initMap"></script>




<% include ../partials/footer %>